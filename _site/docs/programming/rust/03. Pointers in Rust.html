<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li:not(:nth-child(3)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(5) > ul > li:nth-child(3) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(2) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(5) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(5) > ul > li:nth-child(3) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(5) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(5) > ul.nav-list > li.nav-list-item:nth-child(3) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Pointers in Rust | sanhan research</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="Pointers in Rust" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Lesson 5" /> <meta property="og:description" content="Lesson 5" /> <link rel="canonical" href="http://localhost:4000/docs/programming/rust/03.%20Pointers%20in%20Rust.html" /> <meta property="og:url" content="http://localhost:4000/docs/programming/rust/03.%20Pointers%20in%20Rust.html" /> <meta property="og:site_name" content="sanhan research" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Pointers in Rust" /> <meta name="google-site-verification" content="TumEYHq6xpSNuebLNUkEWUMOUm3w7a6mdrQ33DQPEwA" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Lesson 5","headline":"Pointers in Rust","url":"http://localhost:4000/docs/programming/rust/03.%20Pointers%20in%20Rust.html"}</script> <!-- End Jekyll SEO tag --> <!-- Automatically display code inside script tags with type=math/tex using MathJax --> <script type="text/javascript" defer src="/assets/js/mathjax-script-type.js"> </script> <!-- Copied from https://docs.mathjax.org/en/latest/web/components/combined.html --> <script type="text/javascript" id="MathJax-script" defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"> </script> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> sanhan research </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Research category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/research" class="nav-list-link">Research</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Computer Vision category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/research/computer-vision" class="nav-list-link">Computer Vision</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/research/computer-vision/3d-image-reconstruction.html" class="nav-list-link">3D Image Reconstruction - Introduction</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in LLM category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/research/llm" class="nav-list-link">LLM</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/research/llm/rag.html" class="nav-list-link">RAG</a></li><li class="nav-list-item"><a href="/docs/research/llm/control_llm.html" class="nav-list-link">Control theory of LLM</a></li></ul></li><li class="nav-list-item"><a href="/docs/research/unlearning" class="nav-list-link">Machine Unlearning</a></li><li class="nav-list-item"><a href="/docs/research/controls" class="nav-list-link">Controls & Robotics</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Programming category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/programming" class="nav-list-link">Programming</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Algorithms and Data structures category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/programming/algorithms.html" class="nav-list-link">Algorithms and Data structures</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/programming/algorithms/Useful%20Timer%20Class.html" class="nav-list-link">Useful Timer Class</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Concurrent Programming category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/programming/concurrent-programming.html" class="nav-list-link">Concurrent Programming</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/01.%20Introduction.html" class="nav-list-link">01. Introduction</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/02.%20Multitasking.html" class="nav-list-link">02. Multitasking</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/03.%20Multiprocessing.html" class="nav-list-link">03. Multiprocessing</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/04.%20Multithreading.html" class="nav-list-link">04. Multithreading</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/05.%20IPC.html" class="nav-list-link">05. Inter-Process Communication (IPC)</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/06.%20IPC-Message-Passing.html" class="nav-list-link">06. IPC - Message Passing</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/07.%20IPC-Shared-Memory.html" class="nav-list-link">07. IPC - Shared Memory</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/08.%20Decomposition.html" class="nav-list-link">08. Decomposition (In progress)</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/09.%20Decomposition%20-%20Task.html" class="nav-list-link">09. Decomposition - Task Parallelism</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/10.%20Decomposition%20-%20Data.html" class="nav-list-link">10. Decomposition - Data Parallelism</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/11.%20Synchronization.html" class="nav-list-link">11. Synchronization</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/12.%20Synchronization%20-%20Mutexes%20and%20Semaphores.html" class="nav-list-link">12. Synchronization - Mutexes and Semaphores</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/13.%20Synchronization%20-%20Deadlocks.html" class="nav-list-link">13. Synchronization - Deadlock</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/14.%20Synchronization%20-%20Starvation.html" class="nav-list-link">14. Synchronization - Starvation</a></li><li class="nav-list-item"><a href="/docs/programming/concurrent-programming/15.%20Synchronization%20-%20RWLocks%20and%20Spin%20Locks.html" class="nav-list-link">15. Synchronization - RWLock, Spin Lock</a></li></ul></li><li class="nav-list-item"><a href="/docs/programming/cpp.html" class="nav-list-link">C / C++</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Python category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/programming/python.html" class="nav-list-link">Python</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/programming/python/01.%20Typing.html" class="nav-list-link">01. Typing</a></li><li class="nav-list-item"><a href="/docs/programming/python/02.%20Decorator.html" class="nav-list-link">02. Decorators</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Rust category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/programming/rust-programming.html" class="nav-list-link">Rust</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/programming/rust/01.%20Hello,%20World!.html" class="nav-list-link">01. Hello, World!</a></li><li class="nav-list-item"><a href="/docs/programming/rust/02.%20Basic%20Syntax%20in%20Rust.html" class="nav-list-link">02. Basic Syntax in Rust</a></li><li class="nav-list-item"><a href="/docs/programming/rust/03.%20Pointers%20in%20Rust.html" class="nav-list-link">03. Pointers in Rust</a></li></ul></li></ul></li><li class="nav-list-item"><a href="/docs/mathematics" class="nav-list-link">Mathematics</a></li><li class="nav-list-item"><a href="/docs/about.html" class="nav-list-link">About</a></li></ul> <ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/Sangdo-Han" class="nav-list-link external" > GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search sanhan research" aria-label="Search sanhan research" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/docs/programming">Programming</a></li> <li class="breadcrumb-nav-list-item"><a href="/docs/programming/rust-programming.html">Rust</a></li> <li class="breadcrumb-nav-list-item"><span>03. Pointers in Rust</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="3-pointer--memory-related-features"> <a href="#3-pointer--memory-related-features" class="anchor-heading" aria-labelledby="3-pointer--memory-related-features"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Pointer / memory related features </h1> <p>As rust has no garbage collector, programmer needs to allocate memory manually.</p> <details open=""> <summary class="text-delta"> Table of contents </summary> <ul id="markdown-toc"> <li><a href="#3-pointer--memory-related-features" id="markdown-toc-3-pointer--memory-related-features">3. Pointer / memory related features</a> <ul> <li><a href="#31-memory-in-computer" id="markdown-toc-31-memory-in-computer">3.1 Memory in Computer</a></li> <li><a href="#32-owenership" id="markdown-toc-32-owenership">3.2. Owenership</a></li> <li><a href="#33-pointers" id="markdown-toc-33-pointers">3.3. Pointers</a> <ul> <li><a href="#331-reference" id="markdown-toc-331-reference">3.3.1. Reference</a></li> <li><a href="#332-raw-pointer" id="markdown-toc-332-raw-pointer">3.3.2. Raw Pointer</a></li> <li><a href="#333-smart-pointer" id="markdown-toc-333-smart-pointer">3.3.3. Smart Pointer</a></li> </ul> </li> <li><a href="#34-lifetimes" id="markdown-toc-34-lifetimes">3.4. Lifetimes</a></li> </ul> </li> </ul> </details> <h2 id="31-memory-in-computer"> <a href="#31-memory-in-computer" class="anchor-heading" aria-labelledby="31-memory-in-computer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.1 Memory in Computer </h2> <p>In operating system, memory (RAM) is divided into 5 parts (regions, segments): Text (code), bss, data, heap and stack. Those manage memory in runtime.</p> <div align="center"> <p> <image src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/50/Program_memory_layout.pdf/page1-234px-Program_memory_layout.pdf.jpg" /> </p> ref: data segment image <a href="https://en.wikipedia.org/wiki/Data_segment"> from wikipedia </a> </div> <ol> <li> <p>Text (code)<br /> Text stores executable code, generally fixed size.</p> </li> <li> <p>Data <br /> Data stores initialized global variables and <code class="language-plaintext highlighter-rouge">static</code> variables.</p> </li> <li> <p>BSS (Block Started by Symbol) <br /> BSS generally depends on Programming language, however, like C programming language, manages unintialized static variable.</p> </li> <li>Stack <br /> Stack is a LIFO (last-in first-out) data structure, using a mechanism like a piling up pancakes on a plate. Stack manages function calls, local variables, function parameters, and return addresses. Stack pointer is a special register in the CPU keeps track of the top of the stack, pointing the current memory address where new data can be added(malloc), also deleting(free) the topmost data easily. <ul> <li>When a function is called, a new stack frame is created on the stack to hold its local variables, parameters and return address.</li> <li>For a memory allocation, compiler analyzes the code to determine the size of each function’s stack frame. Next, compiler generates instructions to adjust the stack pointer, allocating and dellocating space as needed.</li> <li>function calls and returns automatically add (push) and remove (pop) stack frames, ensuring efficient memory usage.</li> </ul> </li> <li>Heap<br /> Heap is a kind of less organized region of memory, which can be manually directed by user. In the sense of automatic managing, many languages support <code class="language-plaintext highlighter-rouge">garbage collection</code> in these days. Rust does not have a traditional garbage collector. Instead, it relies on ownership and borrowing. Rust also supports pointers like in C or C++ for user’s memory manipulation.</li> </ol> <h2 id="32-owenership"> <a href="#32-owenership" class="anchor-heading" aria-labelledby="32-owenership"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.2. Owenership </h2> <p>Ownership is one of the unique features in rust for handling memory not only within a code block (scope) but also between code blocks.</p> <p><code class="language-plaintext highlighter-rouge">the book</code> suggests three ownership rules as follows:</p> <ol> <li>Each value in Rust has an owner.</li> <li>There can only be one owner at a time.</li> <li>When the owner goes out of scope, the value will be dropped.</li> </ol> <p>Because of axiom #2 and #3, programmers who are familiar with other languages could have in trouble.</p> <p>For instance, in the case of python, the following would work.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># python
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">"hello"</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">print</span><span class="p">((</span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span> <span class="c1"># you can see True, they indicates the same memory address
</span>    <span class="k">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="c1"># you can get 'hello'
</span>    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># you can get 'hello'
</span></code></pre></div></div> <p>with checking ids of x and y are equal, we can see x and y indicates the same address.</p> <p>however, in rust programming, the following rust code which is similar to the above code won’t be compiled.</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span> <span class="c1">// compile error because x has no ownership of value</span>
<span class="p">}</span>
</code></pre></div></div> <p>It seems that y and x “shares” the same address, however, it is not. As I mentioned first, in dealing with heap memory, rust basically moves the ownership from <code class="language-plaintext highlighter-rouge">x</code> to <code class="language-plaintext highlighter-rouge">y</code>. As <code class="language-plaintext highlighter-rouge">y</code> has got ownership of the string value “hello”, <code class="language-plaintext highlighter-rouge">x</code> cannot access the value until it retrieved ownership back or get new value assigned.</p> <h2 id="33-pointers"> <a href="#33-pointers" class="anchor-heading" aria-labelledby="33-pointers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3. Pointers </h2> <p>To solve the above ownership problem, we can also use other options : use memory address!</p> <h3 id="331-reference"> <a href="#331-reference" class="anchor-heading" aria-labelledby="331-reference"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3.1. Reference </h3> <p>The foremost option is that borrow <code class="language-plaintext highlighter-rouge">x</code>’s value with <code class="language-plaintext highlighter-rouge">reference</code>. <br /> Here is an example of <code class="language-plaintext highlighter-rouge">borrowing</code> that y borrows the value from x, and return back automatically when y is called.</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">;</span> <span class="c1">// y borrows (refers) the value of x; </span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span> <span class="c1">// no error: Still, x is owner of "hello"</span>
<span class="p">}</span>
</code></pre></div></div> <p>This <code class="language-plaintext highlighter-rouge">&amp;</code> operator is for referring to x, or borrowing x address. It seems that reference is the same as the pointer in C, however references are always valid and automatically managed by Rust’s borrow checker. <strong>They cannot outlive the data they brought and cannot be null.</strong></p> <p>You can see that those exmaples are based on <code class="language-plaintext highlighter-rouge">string</code> type because string in rust works allocating the memory based on move, not copy or clone. If you use the same examples but <code class="language-plaintext highlighter-rouge">int</code> allocation, there is no error since the basic trait of allocation in <code class="language-plaintext highlighter-rouge">int</code> is value shallow copying.</p> <p>The following code which seems like simply adding a dereference operator <code class="language-plaintext highlighter-rouge">*</code> could make you a little bit crazy.</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span> <span class="c1">// we know, x is a string value "hello"; String</span>
    <span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">;</span> <span class="c1">// y borrows (refers) the value of x; &amp;String</span>
    <span class="k">let</span> <span class="n">z</span> <span class="o">=</span> <span class="o">&amp;*</span><span class="n">x</span><span class="p">;</span> <span class="c1">// (*x) is dereference of x, which is inner string (or string slice) : str </span>
                 <span class="c1">// and then we refer &amp;(*x), which is reference of string slice : &amp;str</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>I added the explanation of x, y and z in the code above with inline comment.</p> <h3 id="332-raw-pointer"> <a href="#332-raw-pointer" class="anchor-heading" aria-labelledby="332-raw-pointer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3.2. Raw Pointer </h3> <p>Still, C-like pointer is also supported in Rust, named as <code class="language-plaintext highlighter-rouge">raw pointer</code>.</p> <p>Raw pointers in Rust are necessary for certain tasks where you need to interact with low-level code, such as interfacing with C libraries, implementing low-level data structures, or performing certain operations that can’t be expressed safely within Rust’s safe abstraction.</p> <p>Here are some scenarios where raw pointers are useful:</p> <ol> <li> <p><strong>Interfacing with C Code</strong>: Rust often needs to interact with C libraries, which typically use raw pointers extensively. Rust’s FFI (Foreign Function Interface) allows you to call functions from C libraries and vice versa, and raw pointers are often used to pass data between Rust and C code.</p> </li> <li> <p><strong>Unsafe Operations</strong>: Some operations inherently require unsafe behavior, such as dereferencing a pointer to arbitrary memory or performing low-level memory manipulation. While these operations should be avoided whenever possible, there are situations where they’re necessary for performance reasons or to implement certain algorithms.</p> </li> <li> <p><strong>Unsafe Abstractions</strong>: Sometimes, you may need to implement your own safe abstractions that rely on unsafe operations internally. While the interface exposed to the user remains safe, the implementation may use raw pointers or other unsafe constructs to achieve certain behaviors efficiently.</p> </li> <li> <p><strong>Low-Level Data Structures</strong>: Implementing low-level data structures like linked lists, trees, or graphs may require direct manipulation of memory addresses, which is facilitated by raw pointers. While Rust’s standard library provides safe abstractions for common data structures, there are cases where custom implementations are necessary or desirable.</p> </li> <li> <p><strong>Embedded Systems and Systems Programming</strong>: In systems programming and embedded systems development, you often need precise control over memory layout and low-level hardware interactions. Raw pointers allow you to express such operations safely within the context of an <code class="language-plaintext highlighter-rouge">unsafe</code> block.</p> </li> </ol> <p>It’s important to note that while raw pointers are a powerful tool, they come with significant responsibility. Rust’s safety guarantees are designed to prevent common programming errors and security vulnerabilities, and bypassing these guarantees with raw pointers can introduce bugs, crashes, or security vulnerabilities if used incorrectly.</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>

    <span class="c1">// Reference to x</span>
    <span class="k">let</span> <span class="n">reference</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">;</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Reference: {}"</span><span class="p">,</span> <span class="n">reference</span><span class="p">);</span>

    <span class="c1">// Raw pointer to x</span>
    <span class="k">let</span> <span class="n">raw_ptr</span><span class="p">:</span> <span class="o">*</span><span class="k">const</span> <span class="nb">i32</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">x</span> <span class="k">as</span> <span class="o">*</span><span class="k">const</span> <span class="nb">i32</span><span class="p">;</span>
    <span class="k">unsafe</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Raw pointer: {}"</span><span class="p">,</span> <span class="o">*</span><span class="n">raw_ptr</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="333-smart-pointer"> <a href="#333-smart-pointer" class="anchor-heading" aria-labelledby="333-smart-pointer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3.3. Smart Pointer </h3> <p>Smart pointers in Rust are data structures that not only hold a value but also contain metadata and provide additional functionality beyond what regular pointers offer. They enforce various safety guarantees at compile time, ensuring memory safety and preventing common programming errors.</p> <p>One of the most commonly used smart pointers in Rust is <code class="language-plaintext highlighter-rouge">Box&lt;T&gt;</code>. It allows you to allocate values on the heap rather than the stack and provides ownership semantics like any other value in Rust. Here’s a brief overview of <code class="language-plaintext highlighter-rouge">Box&lt;T&gt;</code>:</p> <ul> <li><strong>Box&lt;T&gt;</strong>: Box is a smart pointer that owns the data it points to and is stored on the heap (if you’re C++ programmer it resembles <code class="language-plaintext highlighter-rouge">unique_ptr</code> but not nullable.). It’s used when you need to have a value with a known size at compile time but don’t know the precise size until runtime, or when you want to transfer ownership of a value across scopes or threads.</li> </ul> <p>Here’s a simple example of <code class="language-plaintext highlighter-rouge">Box&lt;T&gt;</code>:</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">Box</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span> <span class="c1">// Allocate an integer on the heap</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Value: {}"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span> <span class="c1">// Print the value stored in the Box</span>
<span class="p">}</span>
</code></pre></div></div> <p>In addition to <code class="language-plaintext highlighter-rouge">Box&lt;T&gt;</code>, Rust provides other smart pointers like <code class="language-plaintext highlighter-rouge">Rc&lt;T&gt;</code> and <code class="language-plaintext highlighter-rouge">Arc&lt;T&gt;</code> for shared ownership (<code class="language-plaintext highlighter-rouge">shared_ptr</code> in C++), <code class="language-plaintext highlighter-rouge">Cell&lt;T&gt;</code> and <code class="language-plaintext highlighter-rouge">RefCell&lt;T&gt;</code> for interior mutability, and <code class="language-plaintext highlighter-rouge">Mutex&lt;T&gt;</code> and <code class="language-plaintext highlighter-rouge">RwLock&lt;T&gt;</code> for synchronization, among others. Each smart pointer type has its own characteristics and use cases, allowing you to choose the appropriate one based on your requirements.</p> <p>Smart pointers enable you to write safer, more expressive code by encapsulating complex memory management logic and providing clear ownership semantics.</p> <h2 id="34-lifetimes"> <a href="#34-lifetimes" class="anchor-heading" aria-labelledby="34-lifetimes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.4. Lifetimes </h2> <p>The following’s a code from <code class="language-plaintext highlighter-rouge">the book</code>.</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">longest</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">x</span><span class="nf">.len</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">y</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">string1</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"abcd"</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">string2</span> <span class="o">=</span> <span class="s">"xyz"</span><span class="p">;</span>

    <span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="nf">longest</span><span class="p">(</span><span class="n">string1</span><span class="nf">.as_str</span><span class="p">(),</span> <span class="n">string2</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"The longest string is {}"</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div> <p>If you compile the code above, you will get an error</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>error[E0106]: missing lifetime specifier
 <span class="nt">--</span><span class="o">&gt;</span> src/main.rs:1:32
  |
1 | fn longest<span class="o">(</span>x: &amp;str, y:&amp;str<span class="o">)</span> -&gt; &amp;str <span class="o">{</span>
  |               <span class="nt">----</span>    <span class="nt">----</span>     ^ expected named lifetime parameter
  |
  <span class="o">=</span> <span class="nb">help</span>: this <span class="k">function</span><span class="s1">'s return type contains a borrowed value, but the signature does not say whether it is borrowed from `x` or `y`
help: consider introducing a named lifetime parameter
  |
1 | fn longest&lt;'</span>a&gt;<span class="o">(</span>x: &amp;<span class="s1">'a str, y:&amp;'</span>a str<span class="o">)</span> -&gt; &amp;<span class="s1">'a str {
  |           ++++     ++         ++          ++

For more information about this error, try `rustc --explain E0106`.
</span></code></pre></div></div> <p>what is a lifetime?</p> <p>As we mentioned in <a href="#331-reference">3.1.3. reference</a>, rust compiler prevent the reference outlive the data by using borrow checker : so to speak, try to prevent <code class="language-plaintext highlighter-rouge">dangling pointer</code>.</p> <p>With this function of references signatures, rust compiler worry about the rest of reference. If x is returned, what about y? y could become a dangling pointer. vice versa.</p> <p>Therefore, we need to notify to compiler (actually for ourselves) that the rest reference will be terminated in the same lifetime of the picked (returned) one.</p> <p>In function <code class="language-plaintext highlighter-rouge">longest</code>, returning a reference to x would invalidate y (become a dangling reference) if x was longer. Lifetimes prevent this by making the references’ validity explicit.</p> <p>The fixed version is as follows:</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="n">longest</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">x</span><span class="nf">.len</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">y</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> </main> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <div class="d-flex mt-2"> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script> </body> </html>
